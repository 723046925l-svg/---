version: '3.9'
services:
  postgres:
    image: postgres:16
    environment:
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: postgres
      POSTGRES_DB: iraq_health
    ports: ['5432:5432']
    volumes: [pgdata:/var/lib/postgresql/data]

  redis:
    image: redis:7
    ports: ['6379:6379']

  backend:
    build: ./apps/backend
    command: sh -c "pnpm install && pnpm prisma:migrate && pnpm prisma:seed && pnpm dev"
    env_file: ./apps/backend/.env.example
    ports: ['3000:3000']
    depends_on: [postgres, redis]

  web:
    build: ./apps/web
    command: sh -c "pnpm install && pnpm dev"
    env_file: ./apps/web/.env.example
    ports: ['3001:3000']
    depends_on: [backend]

volumes:
  pgdata:
